name: Notify Discord on Workflow Completion
run-name: Send message with status

on:
  workflow_dispatch:
  workflow_run:
    workflows: ["Execution of Get products"]  # Substitua pelo nome do workflow a ser monitorado
    types:
      - completed  # Executa apenas quando o workflow terminar

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master

      - name: Set up the status message
        id: status_message
        run: |
          echo "title=ðŸ“¢ Status do Workflow" >> $GITHUB_ENV
          echo "description=Workflow **${{ github.event.workflow_run.name }}** no repositÃ³rio **${{ github.repository }}** foi finalizado com status: **${{ github.event.workflow_run.conclusion }}**" >> $GITHUB_ENV
          echo "color=$([[ '${{ github.event.workflow_run.conclusion }}' == 'success' ]] && echo 3066993 || echo 15158332)" >> $GITHUB_ENV
      
      - name: send custom message
        uses: appleboy/discord-action@v1.2.0
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          color: ${{ env.color }}
          username: "Monitor bot"
          message: ${{ env.title }} | ${{ env.description }}