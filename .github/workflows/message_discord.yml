name: Notify Discord on Workflow Completion
run-name: Send message with status

on:
  workflow_dispatch:
  workflow_run:
    workflows: ["Execution of Get products"]  # Substitua pelo nome do workflow a ser monitorado
    types:
      - completed  # Executa apenas quando o workflow terminar

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Set up the status message
        id: status_message
        run: |
          echo "title=üì¢ Status do Workflow" >> $GITHUB_ENV
          echo "description=Workflow **${{ github.event.workflow_run.name }}** no reposit√≥rio **${{ github.repository }}** foi finalizado com status: **${{ github.event.workflow_run.conclusion }}**" >> $GITHUB_ENV
          echo "color=$([[ '${{ github.event.workflow_run.conclusion }}' == 'success' ]] && echo 3066993 || echo 15158332)" >> $GITHUB_ENV

      - name: Enviar notifica√ß√£o para o Discord
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}  # Adicione o webhook como Secret no GitHub
        with:
          embeds: |
            ${{ toJson([ 
              {
                "title": "${{ env.title }}",
                "description": "${{ env.description }}",
                "color": "${{ env.color }}"
              }
            ]) }}
